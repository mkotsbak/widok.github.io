<!DOCTYPE html>
<html lang="british">
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title>Widok User Manual</title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">q { quotes: "“" "”" "‘" "’"; }</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link href="data:text/css,%2F%2A%0A%20%20%20This%20document%20has%20been%20created%20with%20Marked%2Eapp%20%3Chttp%3A%2F%2Fmarked2app%2Ecom%3E%0A%20%20%20Please%20leave%20this%20notice%20in%20place%2C%20along%20with%20any%20additional%20credits%20below%2E%0A%20%20%20%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%2D%0A%20%20%20Title%3A%20Kultiad%0A%20%20%20Author%3A%20Peter%20Sziebig%20%2D%20%40bigpe%3B%20Modified%20by%20Kieran%20Healy%20%2D%20%40kjhealy%0A%20%20%20Description%3A%20Easy%20to%20read%2E%20Pandoc%20style%20elements%2E%0A%2A%2F%0A%0A%0A%0A%0Ahtml%20%7B%0A%20%20%20%20font%2Dsize%3A%20100%25%3B%0A%7D%0Ahtml%2C%20button%2C%20input%2C%20select%2C%20textarea%20%7B%0A%20%20%20%20font%2Dfamily%3A%20sans%2Dserif%3B%0A%7D%0A%0Ahtml%2C%20body%2C%20button%2C%20input%2C%20select%2C%20textarea%20%7B%0A%20%20%20%20color%3A%20%2357534A%3B%0A%20%20%20%20font%2Dfamily%3A%20%22PT%20Serif%22%2C%22Calluna%22%2C%22Arno%20Pro%22%2Cserif%3B%0A%20%20%20%20font%2Dsize%3A%2018px%3B%0A%20%20%20%20font%2Dweight%3A%20300%3B%0A%7D%0A%0Abody%7B%0A%20%20%20%20margin%3A%200%20auto%3B%0A%20%20%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%7D%0A%0Abody%2C%20textarea%20%7B%0A%20%20%20%20line%2Dheight%3A%201%2E4%3B%0A%7D%0A%0A%0Abody%3Aafter%20%7B%0A%20%20%20%20clear%3A%20both%3B%0A%20%20%20%20content%3A%20%22%22%3B%0A%20%20%20%20display%3A%20table%3B%0A%7D%0A%0Abody%20%7B%0A%20%20%20%20padding%2Dleft%3A%206rem%3B%0A%20%20%20%20padding%2Dright%3A%206rem%3B%0A%20%20%20%20margin%2Dleft%3A%20auto%3B%0A%20%20%20%20margin%2Dright%3A%20auto%3B%0A%20%20%20%20max%2Dwidth%3A%2042rem%3B%0A%20%20%20%20display%3A%20block%3B%0A%7D%0A%0A%0A%0Ah1%2C%20h2%2C%20h3%2C%20dt%20%7B%0A%20%20%20%20color%3A%20%23423F37%3B%0A%20%20%20%20font%2Dweight%3A%20700%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20%20%20font%2Dsize%3A%202em%3B%0A%20%20%20%20margin%3A%200%2E67em%200%3B%0A%7D%0Ah2%2C%20%2Earticle%2Dlist%20%2Earticle%2Dtitle%20%7B%0A%20%20%20%20padding%2Dtop%3A%201em%3B%0A%20%20%20%20padding%2Dbottom%3A%200em%3B%0A%20%20%20%20border%2Dbottom%3A%20none%3B%0A%20%20%20%20font%2Dsize%3A%201%2E5em%3B%0A%20%20%20%20margin%3A%200%2E83em%200%3B%0A%7D%0Ah3%2C%20dt%20%7B%0A%20%20%20%20padding%2Dtop%3A%201em%3B%0A%20%20%20%20font%2Dsize%3A%201%2E17em%3B%0A%20%20%20%20font%2Dstyle%3A%20italic%3B%0A%20%20%20%20margin%3A%201em%200%3B%0A%7D%0Ah4%20%7B%0A%20%20%20%20font%2Dsize%3A%201em%3B%0A%20%20%20%20margin%3A%201%2E33em%200%3B%0A%7D%0Ah5%20%7B%0A%20%20%20%20font%2Dsize%3A%200%2E83em%3B%0A%20%20%20%20margin%3A%201%2E67em%200%3B%0A%7D%0Ah6%20%7B%0A%20%20%20%20font%2Dsize%3A%200%2E75em%3B%0A%20%20%20%20margin%3A%202%2E33em%200%3B%0A%7D%0A%0A%0Aa%20%7B%0A%20%20%20%20color%3A%20%238DB359%3B%0A%20%20%20%20cursor%3A%20pointer%3B%0A%20%20%20%20outline%3A%200%20none%3B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%0A%7D%0A%0Aa%3Ahover%20%7B%0A%20%20%20%20outline%3A%200%20none%3B%0A%20%20%20%20color%3A%20%23739544%3B%0A%7D%0A%0A%0Ap%2C%20pre%20%7B%0A%20%20%20%20margin%3A%201em%200%3B%0A%7D%0A%0Acode%2C%20kbd%2C%20pre%2C%20samp%20%7B%0A%20%20%20%20font%2Dfamily%3A%20monospace%2Cserif%3B%0A%20%20%20%20font%2Dsize%3A%201em%3B%0A%20%20%20%20margin%3A%200%3B%0A%20%20%20%20padding%3A%200%3B%0A%0A%7D%0Apre%20%7B%0A%20%20%20%20white%2Dspace%3A%20pre%2Dwrap%3B%0A%20%20%20%20word%2Dwrap%3A%20break%2Dword%3B%0A%7D%0A%0Apre%20%7B%0A%20%20%20%20background%2Dcolor%3A%20%23F8F5F0%3B%0A%20%20%20%20font%2Dsize%3A%200%2E7rem%3B%0A%20%20%20%20overflow%2Dx%3A%20auto%3B%0A%20%20%20%20padding%3A%201%2E3rem%3B%0A%20%20%20%20position%3A%20relative%3B%0A%20%20%20%20white%2Dspace%3A%20pre%3B%0A%20%20%20%20word%2Dwrap%3A%20normal%3B%0A%7D%0Apre%2C%20code%2C%20kbd%2C%20samp%20%7B%0A%20%20%20%20margin%3A%200%3B%0A%7D%0Acode%2C%20kbd%2C%20pre%2C%20samp%20%7B%0A%20%20%20%20font%2Dfamily%3A%20monospace%2Cserif%3B%0A%7D%0A%0Acode%20%7B%0A%20%20%20%20color%3A%20%23423F37%3B%0A%7D%0A%0A%0Aaside%20%7B%0A%20%20%20%20display%3A%20block%3B%0A%20%20%20%20float%3A%20right%3B%0A%20%20%20%20width%3A%20390px%3B%0A%7D%0A%0A%0Ab%2C%20strong%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20color%3A%20%23423F37%3B%0A%20%20%20%20font%2Dweight%3A%20700%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20%20%20color%3A%20%23423F37%3B%0A%20%20%20%20margin%3A%201em%2040px%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20%20%20margin%2Dbottom%3A%202em%3B%0A%20%20%20%20margin%2Dtop%3A%202em%3B%0A%7D%0A%0Afigure%20%7B%0A%09margin%2Dleft%3A%20%2D4%2E5rem%3B%0A%20%20%20%20margin%2Dright%3A%20%2D4%2E5rem%3B%0A%20%20%20%20margin%2Dbottom%3A%202em%3B%0A%20%20%20%20margin%2Dtop%3A%202em%3B%0A%7D%0A%0A%0Ahr%20%7B%0A%20%20%20%20%2Dmoz%2Dborder%2Dbottom%2Dcolors%3A%20none%3B%0A%20%20%20%20%2Dmoz%2Dborder%2Dleft%2Dcolors%3A%20none%3B%0A%20%20%20%20%2Dmoz%2Dborder%2Dright%2Dcolors%3A%20none%3B%0A%20%20%20%20%2Dmoz%2Dborder%2Dtop%2Dcolors%3A%20none%3B%0A%20%20%20%20border%2Dcolor%3A%20%2Dmoz%2Duse%2Dtext%2Dcolor%20%2Dmoz%2Duse%2Dtext%2Dcolor%20%23ECE6DA%3B%0A%20%20%20%20border%2Dimage%3A%20none%3B%0A%20%20%20%20border%2Dstyle%3A%20none%20none%20solid%3B%0A%20%20%20%20border%2Dwidth%3A%20medium%20medium%201px%3B%0A%20%20%20%20margin%3A%203em%206em%3B%0A%7D%0A%0A%0Aimg%20%7B%0A%20%20%20%20max%2Dwidth%3A%20100%25%3B%0A%20%20%20%20display%3A%20block%3B%0A%20%20%20%20border%3A%200%20none%3B%0A%7D%0A%0A%0Aol%20%3E%20li%3Abefore%20%7B%0A%20%20%20%20color%3A%20%23423F37%3B%0A%20%20%20%20content%3A%20counter%28ol%2C%20decimal%29%20%22%2E%22%3B%0A%20%20%20%20counter%2Dincrement%3A%20ol%3B%0A%20%20%20%20font%2Dweight%3A%20700%3B%0A%20%20%20%20margin%2Dright%3A%200%2E333em%3B%0A%20%20%20%20position%3A%20absolute%3B%0A%20%20%20%20right%3A%20100%25%3B%0A%7D%0A%0Aul%20%3E%20li%3Abefore%20%7B%0A%20%20%20%20background%2Dcolor%3A%20%23423F37%3B%0A%20%20%20%20border%2Dradius%3A%2014px%2014px%2014px%2014px%3B%0A%20%20%20%20content%3A%20%22%22%3B%0A%20%20%20%20height%3A%206px%3B%0A%20%20%20%20margin%2Dright%3A%200%2E333em%3B%0A%20%20%20%20margin%2Dtop%3A%200%2E55em%3B%0A%20%20%20%20position%3A%20absolute%3B%0A%20%20%20%20right%3A%20100%25%3B%0A%20%20%20%20width%3A%206px%3B%0A%7D%0A%0Aol%2C%20ul%2C%20dl%20%7B%0A%20%20%20%20margin%2Dleft%3A%202rem%3B%0A%20%20%20%20padding%3A%200%3B%0A%7D%0Aol%20%7B%0A%20%20%20%20counter%2Dreset%3A%20ol%3B%0A%7D%0Ali%20%2B%20li%2C%20dd%20%2B%20dt%20%7B%0A%20%20%20%20margin%2Dtop%3A%200%2E5em%3B%0A%7D%0A%0Aul%20%3E%20li%20%7B%0A%20%20%20%20position%3A%20relative%3B%0A%7D%0A%0Aol%20%3E%20li%20%7B%0A%20%20%20%20position%3A%20relative%3B%0A%7D%0Ali%20%7B%0A%20%20%20%20list%2Dstyle%3A%20none%20outside%20none%3B%0A%7D%0A%0A%0Afigure%20%3E%20figcaption%20%7B%0A%20%20%20%20margin%2Dtop%3A%200%2E5em%3B%0A%7D%0Asmall%2C%20dd%2C%20figcaption%20%7B%0A%20%20%20%20color%3A%20%23A19C91%3B%0A%20%20%20%20display%3A%20block%3B%0A%20%20%20%20font%2Dsize%3A%200%2E8rem%3B%0A%20%20%20%20font%2Dstyle%3A%20italic%3B%0A%20%20%20%20line%2Dheight%3A%201%2E2%3B%0A%7D%0A%0A%0Atbody%7Bdisplay%3Atable%2Drow%2Dgroup%7D%0Atfoot%7Bdisplay%3Atable%2Dfooter%2Dgroup%7D%0Atable%7Bmargin%2Dbottom%3A2em%3Bfont%2Dsize%3A%200%2E8em%3Bpadding%3A0%3Bborder%2Dcollapse%3Acollapse%3B%2Dwebkit%2Dbox%2Dshadow%3A1px%201px%202px%20rgba%280%2C0%2C0%2C%2E35%29%3Bwidth%3A80%25%3Bmargin%3A0%20auto%202em%20auto%7D%0Atable%20th%2Ctable%20td%7Bpadding%3A10px%2010px%209px%3Bline%2Dheight%3A18px%3Btext%2Dalign%3Aleft%7D%0Atable%20th%7B%0Apadding%2Dtop%3A9px%3B%21important%3Btext%2Dtransform%3Auppercase%3Bvertical%2Dalign%3Amiddle%7D%0Atable%20td%7Bvertical%2Dalign%3Atop%3Bborder%2Dtop%3A1px%20solid%20%23ddd%3B%7D%0Atable%20tbody%20th%7Bborder%2Dtop%3A1px%20solid%20%23ddd%3Bvertical%2Dalign%3Atop%7D%0Atable%7Bborder%3A1px%20solid%20%23ddd%3Bborder%2Dcollapse%3Aseparate%3B%2Aborder%2Dcollapse%3Acollapse%3B%2Dwebkit%2Dborder%2Dradius%3A4px%3B%2Dmoz%2Dborder%2Dradius%3A4px%3Bborder%2Dradius%3A4px%7D%0Atable%20th%2Bth%2Ctable%20td%2Btd%2Ctable%20th%2Btd%7Bborder%2Dleft%3A1px%20solid%20%23ddd%7D%0Atable%20thead%20tr%3Afirst%2Dchild%20th%3Afirst%2Dchild%2Ctable%20tbody%20tr%3Afirst%2Dchild%20td%3Afirst%2Dchild%7B%2Dwebkit%2Dborder%2Dradius%3A4px%200%200%200%3B%2Dmoz%2Dborder%2Dradius%3A4px%200%200%200%3Bborder%2Dradius%3A4px%200%200%200%7D%0Atable%20thead%20tr%3Afirst%2Dchild%20th%3Alast%2Dchild%2Ctable%20tbody%20tr%3Afirst%2Dchild%20td%3Alast%2Dchild%7B%2Dwebkit%2Dborder%2Dradius%3A0%204px%200%200%3B%2Dmoz%2Dborder%2Dradius%3A0%204px%200%200%3Bborder%2Dradius%3A0%204px%200%200%7D%0Atable%20tbody%20tr%3Alast%2Dchild%20td%3Afirst%2Dchild%7B%2Dwebkit%2Dborder%2Dradius%3A0%200%200%204px%3B%2Dmoz%2Dborder%2Dradius%3A0%200%200%204px%3Bborder%2Dradius%3A0%200%200%204px%7D%0Atable%20tbody%20tr%3Alast%2Dchild%20td%3Alast%2Dchild%7B%2Dwebkit%2Dborder%2Dradius%3A0%200%204px%200%3B%2Dmoz%2Dborder%2Dradius%3A0%200%204px%200%3Bborder%2Dradius%3A0%200%204px%200%7D%0Atbody%20tr%3Anth%2Dchild%28odd%29%7Bbackground%2Dcolor%3Argba%280%2C0%2C0%2C0%2E03%29%7D%0A%0Acaption%7Bdisplay%3Atable%2Dcaption%3Bfont%2Dweight%3A300%3Bfont%2Dsize%3A1%2E3em%3Btext%2Dtransform%3Auppercase%3Bletter%2Dspacing%3A2px%3Bword%2Dspacing%3A%2E2em%3Bbackground%3Argba%280%2C0%2C0%2C%2E75%29%3Bcolor%3A%23EEE%3Bpadding%3A4px%3B%2Dwebkit%2Dborder%2Dradius%3A4px%3Bmargin%3A4px%200%3B%2Dwebkit%2Dbox%2Dshadow%3A2px%202px%202px%20rgba%280%2C0%2C0%2C%2E35%29%7D%0A%0A%2F%2A%20grey%20out%20placeholders%20%2A%2F%0A%3A%2Dmoz%2Dplaceholder%20%7B%0A%20%20color%3A%20%23bfbfbf%3B%0A%7D%0A%3A%3A%2Dwebkit%2Dinput%2Dplaceholder%20%7B%0A%20%20color%3A%20%23bfbfbf%3B%0A%7D%0A%0A%0A%2Earticle%2Ddate%20%7B%0A%20%20%20%20color%3A%20%23C7C2B8%3B%0A%20%20%20%20display%3A%20block%3B%0A%20%20%20%20font%2Dsize%3A%200%2E8rem%3B%0A%7D%0A%0A%2Etitle%7B%0A%20%20%20%20padding%2Dbottom%3A%201em%3B%0A%7D%0A%0A%2Eauthor%7B%0A%20%20padding%2Dtop%3A%200%2E5em%3B%0A%20%20font%2Dsize%3A1%2E24em%3B%0A%20%20line%2Dheight%3A0%2E5em%3B%0A%7D%0A%0A%2Edate%20%7B%0A%20%20%20%20color%3A%20%23C7C2B8%3B%0A%20%20%20%20display%3A%20block%3B%0A%20%20%20%20font%2Dsize%3A%200%2E8rem%3B%0A%7D%0A%0A%2Ecaption%20%7B%0A%20%20%20display%3A%20block%3B%0A%20%20%20font%2Dsize%3A%200%2E8rem%3B%0A%20%20%20font%2Dstyle%3A%20italic%3B%0A%7D%0A%0A%2Esmall%7B%0A%20font%2Dsize%3A0%2E8em%3B%0A%7D%0A%0A%2Eaffiliation%7B%0A%20margin%2Dtop%3A%200%3B%0A%20padding%2Dtop%3A%200%3B%0A%20font%2Dsize%3A0%2E9em%3B%0A%20font%2Dstyle%3A%20italic%3B%0A%7D%0A%0A" rel="stylesheet">
</head>
<body>
<header>
<h3 class="date">February 2015</h3>

<h1 class="title">Widok User Manual</h1>


<h2 class="author">Tim Nieradzik</h2>
<p class="affilation"><em>University of Bremen</em></p>

</header>

<nav id="TOC">
<ul>
<li><a href="#introduction"><span class="toc-section-number">1</span> Introduction</a><ul>
<li><a href="#comparison"><span class="toc-section-number">1.1</span> Comparison</a></li>
<li><a href="#data-propagation"><span class="toc-section-number">1.2</span> Data propagation</a></li>
</ul></li>
<li><a href="#getting-started"><span class="toc-section-number">2</span> Getting Started</a><ul>
<li><a href="#first-project"><span class="toc-section-number">2.1</span> First project</a></li>
<li><a href="#troubleshooting"><span class="toc-section-number">2.2</span> Troubleshooting</a></li>
<li><a href="#compilation"><span class="toc-section-number">2.3</span> Compilation</a></li>
</ul></li>
<li><a href="#concepts"><span class="toc-section-number">3</span> Concepts</a><ul>
<li><a href="#continuous-compilation"><span class="toc-section-number">3.1</span> Continuous compilation</a></li>
<li><a href="#single-page-applications"><span class="toc-section-number">3.2</span> Single-page applications</a></li>
<li><a href="#multi-page-applications"><span class="toc-section-number">3.3</span> Multi-page applications</a></li>
<li><a href="#widgets"><span class="toc-section-number">3.4</span> Widgets</a></li>
<li><a href="#pages"><span class="toc-section-number">3.5</span> Pages</a></li>
</ul></li>
<li><a href="#build-process"><span class="toc-section-number">4</span> Build process</a><ul>
<li><a href="#development-releases"><span class="toc-section-number">4.1</span> Development releases</a></li>
<li><a href="#production-releases"><span class="toc-section-number">4.2</span> Production releases</a></li>
<li><a href="#links"><span class="toc-section-number">4.3</span> Links</a></li>
</ul></li>
<li><a href="#applications"><span class="toc-section-number">5</span> Applications</a><ul>
<li><a href="#entry-point"><span class="toc-section-number">5.1</span> Entry point</a></li>
<li><a href="#application-providers"><span class="toc-section-number">5.2</span> Application providers</a><ul>
<li><a href="#single-page-applications-1"><span class="toc-section-number">5.2.1</span> Single-page applications</a></li>
<li><a href="#multi-page-applications-1"><span class="toc-section-number">5.2.2</span> Multi-page applications</a></li>
</ul></li>
</ul></li>
<li><a href="#router"><span class="toc-section-number">6</span> Router</a><ul>
<li><a href="#interface"><span class="toc-section-number">6.1</span> Interface</a></li>
<li><a href="#routes"><span class="toc-section-number">6.2</span> Routes</a><ul>
<li><a href="#motivation"><span class="toc-section-number">6.2.1</span> Motivation</a></li>
</ul></li>
<li><a href="#application-provider"><span class="toc-section-number">6.3</span> Application provider</a></li>
</ul></li>
<li><a href="#widgets-1"><span class="toc-section-number">7</span> Widgets</a><ul>
<li><a href="#html"><span class="toc-section-number">7.1</span> HTML</a><ul>
<li><a href="#usage"><span class="toc-section-number">7.1.1</span> Usage</a></li>
</ul></li>
<li><a href="#bootstrap"><span class="toc-section-number">7.2</span> Bootstrap</a></li>
<li><a href="#creating-custom-widgets"><span class="toc-section-number">7.3</span> Creating custom widgets</a></li>
<li><a href="#binding-to-events"><span class="toc-section-number">7.4</span> Binding to events</a></li>
<li><a href="#links-1"><span class="toc-section-number">7.5</span> Links</a></li>
</ul></li>
<li><a href="#data-propagation-1"><span class="toc-section-number">8</span> Data Propagation</a><ul>
<li><a href="#channels"><span class="toc-section-number">8.1</span> Channels</a><ul>
<li><a href="#state-channels"><span class="toc-section-number">8.1.1</span> State channels</a></li>
<li><a href="#child-channels"><span class="toc-section-number">8.1.2</span> Child channels</a></li>
<li><a href="#cached-channels"><span class="toc-section-number">8.1.3</span> Cached channels</a></li>
<li><a href="#widgets-2"><span class="toc-section-number">8.1.4</span> Widgets</a></li>
</ul></li>
<li><a href="#aggregates"><span class="toc-section-number">8.2</span> Aggregates</a><ul>
<li><a href="#cached-aggregates"><span class="toc-section-number">8.2.1</span> Cached aggregates</a></li>
<li><a href="#widgets-3"><span class="toc-section-number">8.2.2</span> Widgets</a></li>
</ul></li>
<li><a href="#debugging"><span class="toc-section-number">8.3</span> Debugging</a></li>
<li><a href="#api-documentation"><span class="toc-section-number">8.4</span> API documentation</a></li>
</ul></li>
<li><a href="#developing"><span class="toc-section-number">9</span> Developing</a><ul>
<li><a href="#api"><span class="toc-section-number">9.1</span> API</a></li>
<li><a href="#compilation-1"><span class="toc-section-number">9.2</span> Compilation</a></li>
<li><a href="#releases"><span class="toc-section-number">9.3</span> Releases</a></li>
</ul></li>
</ul>
</nav>

<p class="small"><strong>Abstract: </strong><em>Widok is a reactive web framework for Scala.js. It enables you to develop interactive web applications entirely in Scala by transpiling the code to JavaScript. Abstractions such as <em>views</em>, <em>channels</em> or <em>aggregates</em> allow for concise and reliable code. Widok ships native bindings for popular CSS frameworks like Bootstrap and Font-Awesome which let you iterate faster.</em></p>

<h1 id="introduction"><span class="header-section-number">1</span> Introduction</h1>
<p>Widok is a reactive web framework for Scala.js. Its key concepts are:</p>
<ul>
<li><strong>Page:</strong> the browser query is dispatched to a page which renders widgets</li>
<li><strong>Widget:</strong> an element that corresponds to a node in the DOM</li>
<li><strong>Channel:</strong> a stream of values</li>
<li><strong>Aggregate:</strong> a channel container</li>
</ul>
<h2 id="comparison"><span class="header-section-number">1.1</span> Comparison</h2>
<p>Widok is different from traditional web frameworks in the following aspects:</p>
<ul>
<li>The rendering logic is implemented entirely on the client-side</li>
<li>The sole purpose of the server is to exchange data with the client</li>
<li>Instead of writing HTML templates, widgets are defined in pure Scala code</li>
<li>Only widgets are allowed to manipulate the DOM</li>
<li>Designed with memory-efficiency in mind</li>
<li>Bootstrap 3 bindings available</li>
</ul>
<p>As Widok is built around Scala.js it also inherits some of its properties:</p>
<ul>
<li>IDE support</li>
<li>Browser source maps</li>
<li>Fast compilation times</li>
</ul>
<h2 id="data-propagation"><span class="header-section-number">1.2</span> Data propagation</h2>
<p>Channels model continuous values as streams. These streams can be observed. Internally, no copies of the produced values are created. If desired, the current value can be explicitly cached, though. It is possible to operate on channels with higher-order functions such as <code>map()</code> and <code>filter()</code>. Every time a new value is produced, it is propagated down the observer chain.</p>
<p>Aggregates are channel containers. They allow to deal with large lists efficiently. If an item gets added, removed or updated, this is reflected directly by a change in the DOM, only operating on the actual nodes.</p>
<h1 id="getting-started"><span class="header-section-number">2</span> Getting Started</h1>
<h2 id="first-project"><span class="header-section-number">2.1</span> First project</h2>
<p>We recommend the use of SBT for compilation as it supports continuous compilation and is the official build system used by Scala.js. If you want to use an IDE, Widok is well-supported by IntelliJ.</p>
<p>Create a new directory <code>project</code> with two files:</p>
<ul>
<li><code>plugins.sbt</code></li>
</ul>
<pre class="sourceCode scala"><code class="sourceCode scala">logLevel := Level.<span class="fu">Warn</span>

<span class="fu">addSbtPlugin</span>(<span class="st">&quot;org.scala-lang.modules.scalajs&quot;</span> % <span class="st">&quot;scalajs-sbt-plugin&quot;</span> % <span class="st">&quot;0.5.5&quot;</span>)</code></pre>
<ul>
<li><code>Build.scala</code></li>
</ul>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">import</span> sbt.<span class="fu">_</span>
<span class="kw">import</span> sbt.<span class="fu">Keys</span>.<span class="fu">_</span>
<span class="kw">import</span> scala.<span class="fu">scalajs</span>.<span class="fu">sbtplugin</span>.<span class="fu">ScalaJSPlugin</span>.<span class="fu">_</span>

<span class="kw">object</span> Build <span class="kw">extends</span> sbt.<span class="fu">Build</span> {
  <span class="kw">val</span> projectName = <span class="st">&quot;example&quot;</span>
  <span class="kw">val</span> buildOrganisation = <span class="st">&quot;org.widok&quot;</span>
  <span class="kw">val</span> buildVersion = <span class="st">&quot;0.1-SNAPSHOT&quot;</span>
  <span class="kw">val</span> buildScalaVersion = <span class="st">&quot;2.11.2&quot;</span>
  <span class="kw">val</span> buildScalaOptions = Seq(
    <span class="st">&quot;-unchecked&quot;</span>, <span class="st">&quot;-deprecation&quot;</span>,
    <span class="st">&quot;-encoding&quot;</span>, <span class="st">&quot;utf8&quot;</span>,
    <span class="st">&quot;-Xelide-below&quot;</span>, annotation.<span class="fu">elidable</span>.<span class="fu">ALL</span>.<span class="fu">toString</span>)

  <span class="kw">lazy</span> <span class="kw">val</span> main = <span class="fu">Project</span>(id = projectName, base = <span class="fu">file</span>(<span class="st">&quot;.&quot;</span>))
    .<span class="fu">settings</span>(scalaJSSettings: _*)
    .<span class="fu">settings</span>(
      libraryDependencies ++= Seq(
        <span class="st">&quot;io.github.widok&quot;</span> %%% <span class="st">&quot;widok&quot;</span> % <span class="st">&quot;0.1.3&quot;</span>
      ),
      organization := buildOrganisation,
      version := buildVersion,
      scalaVersion := buildScalaVersion,
      scalacOptions := buildScalaOptions,
      ScalaJSKeys.<span class="fu">persistLauncher</span> := <span class="kw">true</span>
    )
}</code></pre>
<p>The source code goes underneath <code>src/main/scala/org/example</code>.</p>
<p>Create a source file <code>Main.scala</code> with the following contents:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">package</span> org.<span class="fu">widok</span>.<span class="fu">example</span>

<span class="kw">import</span> org.<span class="fu">widok</span>.<span class="fu">_</span>
<span class="kw">import</span> org.<span class="fu">widok</span>.<span class="fu">bindings</span>.<span class="fu">HTML</span>

<span class="kw">object</span> Main <span class="kw">extends</span> PageApplication {
  <span class="kw">def</span> <span class="fu">contents</span>() = Seq(
    HTML.<span class="fu">Heading</span>.<span class="fu">Level1</span>(<span class="st">&quot;Welcome to Widok!&quot;</span>),
    HTML.<span class="fu">Paragraph</span>(<span class="st">&quot;This is your first application.&quot;</span>))

  <span class="kw">def</span> <span class="fu">ready</span>() {
    <span class="fu">log</span>(<span class="st">&quot;Page loaded.&quot;</span>)
  }
}</code></pre>
<p>Finally, you need to create an HTML file <code>application.html</code> in the root directory which includes the compiled JavaScript sources:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span>
<span class="kw">&lt;html&gt;</span>
  <span class="kw">&lt;head&gt;</span>
    <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">&quot;utf-8&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;title&gt;</span>Widok example<span class="kw">&lt;/title&gt;</span>
  <span class="kw">&lt;/head&gt;</span>
  <span class="kw">&lt;body</span><span class="ot"> id=</span><span class="st">&quot;page&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="ot"> src=</span><span class="st">&quot;./target/scala-2.11/example-fastopt.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
    <span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="ot"> src=</span><span class="st">&quot;./target/scala-2.11/example-launcher.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
  <span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre>
<p>To compile your application application, run:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">sbt</span> fastOptJS</code></pre>
<p>Now you can open <code>application.html</code> in your browser.</p>
<h2 id="troubleshooting"><span class="header-section-number">2.2</span> Troubleshooting</h2>
<p>If sbt does not find the shapeless dependency, try to add the following resolver:</p>
<pre class="sourceCode scala"><code class="sourceCode scala">resolvers += <span class="st">&quot;bintray-alexander_myltsev&quot;</span> at <span class="st">&quot;http://dl.bintray.com/alexander-myltsev/maven/&quot;</span></code></pre>
<p>See also https://github.com/widok/todomvc/issues/1</p>
<h2 id="compilation"><span class="header-section-number">2.3</span> Compilation</h2>
<p>The latest version is always published to Sonatype and Maven Central. Therefore, no manual compilation of Widok is required. Please refer to <a href="#developing">Developing</a> if you would like to try out the latest development release.</p>
<h1 id="concepts"><span class="header-section-number">3</span> Concepts</h1>
<p>In this chapter we will mention all key concepts of Widok. The following chapters will deal with these topics in detail.</p>
<h2 id="continuous-compilation"><span class="header-section-number">3.1</span> Continuous compilation</h2>
<p>SBT can detect changes in source files. It recompiles the project only when needed:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">sbt</span> ~fastOptJS</code></pre>
<h2 id="single-page-applications"><span class="header-section-number">3.2</span> Single-page applications</h2>
<p>The basic application from the <a href="#getting-started">previous chapter</a> looked like this:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">package</span> org.<span class="fu">widok</span>.<span class="fu">example</span>

<span class="kw">import</span> org.<span class="fu">widok</span>.<span class="fu">_</span>
<span class="kw">import</span> org.<span class="fu">widok</span>.<span class="fu">bindings</span>.<span class="fu">HTML</span>

<span class="kw">object</span> Main <span class="kw">extends</span> PageApplication {
  <span class="kw">def</span> <span class="fu">contents</span>() = Seq(
    HTML.<span class="fu">Heading</span>.<span class="fu">Level1</span>(<span class="st">&quot;Welcome to Widok!&quot;</span>),
    HTML.<span class="fu">Paragraph</span>(<span class="st">&quot;This is your first application.&quot;</span>))

  <span class="kw">def</span> <span class="fu">ready</span>() {
    <span class="fu">log</span>(<span class="st">&quot;Page loaded.&quot;</span>)
  }
}</code></pre>
<p>This is a single-page application. The two methods <code>contents()</code> and <code>ready()</code> must be implemented. <code>contents()</code> is a list of widgets that are rendered when the page is loaded. Afterwards, <code>ready()</code> gets called.</p>
<h2 id="multi-page-applications"><span class="header-section-number">3.3</span> Multi-page applications</h2>
<p>While for small applications a single-page approach may be sufficient, you should consider using a router and split the application into multiple pages.</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">package</span> org.<span class="fu">widok</span>.<span class="fu">example</span>

<span class="kw">import</span> org.<span class="fu">widok</span>.<span class="fu">_</span>

<span class="kw">object</span> Routes {
  <span class="kw">val</span> main = <span class="fu">Route</span>(<span class="st">&quot;/&quot;</span>, pages.<span class="fu">Main</span>())
  <span class="kw">val</span> test = <span class="fu">Route</span>(<span class="st">&quot;/test/:param&quot;</span>, pages.<span class="fu">Test</span>())
  <span class="kw">val</span> notFound = <span class="fu">Route</span>(<span class="st">&quot;/404&quot;</span>, pages.<span class="fu">NotFound</span>())

  <span class="kw">val</span> routes = Set(main, test, notFound)
}

<span class="kw">object</span> Main <span class="kw">extends</span> <span class="fu">RoutingApplication</span>(Routes.<span class="fu">routes</span>, Routes.<span class="fu">notFound</span>)</code></pre>
<p>The <code>Routes</code> objects defines all available routes. A query part may also be a named parameter. If the query parameters need to be validated, this should be done in the page itself.</p>
<p>Create a new file for each page:</p>
<ul>
<li><code>pages/Main.scala</code></li>
</ul>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">package</span> org.<span class="fu">widok</span>.<span class="fu">example</span>.<span class="fu">pages</span>

<span class="kw">import</span> org.<span class="fu">widok</span>.<span class="fu">_</span>
<span class="kw">import</span> org.<span class="fu">widok</span>.<span class="fu">Widget</span>
<span class="kw">import</span> org.<span class="fu">widok</span>.<span class="fu">bindings</span>.<span class="fu">HTML</span>
<span class="kw">import</span> org.<span class="fu">widok</span>.<span class="fu">example</span>.<span class="fu">Routes</span>

<span class="kw">case</span> <span class="kw">class</span> <span class="fu">Main</span>() <span class="kw">extends</span> Page {
  <span class="kw">def</span> <span class="fu">contents</span>() = HTML.<span class="fu">Anchor</span>(<span class="st">&quot;Link to second page&quot;</span>).<span class="fu">url</span>(Routes.<span class="fu">test</span>(<span class="st">&quot;param&quot;</span>, <span class="st">&quot;first page&quot;</span>))

  <span class="kw">def</span> <span class="fu">ready</span>(route: InstantiatedRoute) {
    <span class="fu">println</span>(<span class="st">&quot;Page 'main' loaded.&quot;</span>)
  }
}</code></pre>
<p>Contrary to single-page applications, <code>ready()</code> expects a parameter which contains information about the chosen route and its parameters.</p>
<p>A route can be instantiated with parameters (<code>Routes.ROUTE(params)</code>). This method is overloaded. If a route has more than one parameter, a map must be passed instead.</p>
<p><code>HTML.Anchor()</code> is a widget that creates a link. In the above example the target path is set to an instantiated route. This is to be preferred over creating links with hand-written paths. Using instantiated routes ensures during compile-time that no invalid routes are referenced. During runtime, assertions will even check whether the correct parameters were specified.</p>
<ul>
<li><code>pages/Test.scala</code></li>
</ul>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">package</span> org.<span class="fu">widok</span>.<span class="fu">example</span>.<span class="fu">pages</span>

<span class="kw">import</span> org.<span class="fu">widok</span>.<span class="fu">_</span>

<span class="kw">case</span> <span class="kw">class</span> <span class="fu">Test</span>() <span class="kw">extends</span> Page {
  <span class="kw">val</span> query = Channel[String]()

  <span class="kw">def</span> <span class="fu">contents</span>() = Seq(<span class="st">&quot;Received parameter: &quot;</span>, query)

  <span class="kw">def</span> <span class="fu">ready</span>(route: InstantiatedRoute) {
    query := route.<span class="fu">args</span>(<span class="st">&quot;param&quot;</span>)
  }
}</code></pre>
<p>We are registering a channel and pass it the current query parameter. A channel can be considered as a stream you can send data to. The data then gets directly multiplexed to the subscribers. It is used as a widget in <code>contents()</code>. This subscribes to the channel and whenever a new value is sent to it, it gets rendered automatically without any caching involved.</p>
<p>Each page is instantiated only once (in <code>Routes</code>). If the user changes the URI parameter, the router detects this and calls <code>ready()</code> again. This feeds the channel the new parameter. The actual HTML page never gets reloaded.</p>
<ul>
<li><code>pages/NotFound.scala</code></li>
</ul>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">package</span> org.<span class="fu">widok</span>.<span class="fu">example</span>.<span class="fu">pages</span>

<span class="kw">import</span> org.<span class="fu">scalajs</span>.<span class="fu">dom</span>
<span class="kw">import</span> org.<span class="fu">widok</span>.<span class="fu">_</span>
<span class="kw">import</span> org.<span class="fu">widok</span>.<span class="fu">bindings</span>.<span class="fu">HTML</span>
<span class="kw">import</span> org.<span class="fu">widok</span>.<span class="fu">example</span>.<span class="fu">Routes</span>

<span class="kw">case</span> <span class="kw">class</span> NotFound() <span class="kw">extends</span> Page {
  <span class="kw">def</span> <span class="fu">contents</span>() = HTML.<span class="fu">Heading</span>.<span class="fu">Level1</span>(<span class="st">&quot;Page not found&quot;</span>)

  <span class="kw">def</span> <span class="fu">ready</span>(route: InstantiatedRoute) {
    dom.<span class="fu">setTimeout</span>(() =&gt; Routes.<span class="fu">main</span>().<span class="fu">go</span>(), <span class="dv">2000</span>)
  }
}</code></pre>
<p>In the router this page was set as a fall-back route and is loaded if no other page matches (or is loaded explictly). Here we are showing how to call JavaScript functions using the <a href="https://github.com/scala-js/scala-js-dom">DOM bindings</a>. It calls <code>go()</code> on the <code>main</code> route after two seconds which redirects to it.</p>
<h2 id="widgets"><span class="header-section-number">3.4</span> Widgets</h2>
<p>The method <code>contents()</code> must return a sequence of widgets. When the page is loaded, Widok looks for the element <code>page</code> in the DOM and adds all rendered widgets from <code>contents()</code> to it.</p>
<p>Widok defines a couple of implicits to make your code more concise. For example, if there is only one element you could drop the sequence and write:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">def</span> <span class="fu">contents</span>() = HTML.<span class="fu">Paragraph</span>(<span class="st">&quot;text&quot;</span>) <span class="co">// &lt;p&gt;text&lt;/p&gt;</span></code></pre>
<p>All widgets that expect children actually expect widgets themselves. Therefore, Widok also provides an implicit to convert strings. As in the above example, most channels are converted as well.</p>
<p>The most notable difference to the traditional approach is that instead of writing HTML code you are dealing with type-safe widgets. Widok provides widget bindings for most HTML tags and even custom bindings for Bootstrap. While it is technically possible to embed HTML code (<code>HTML.Raw()</code>) and access the elements using <code>getElementById()</code> as in JavaScript, this is discouraged as Widok provides better ways to interact with elements.</p>
<h2 id="pages"><span class="header-section-number">3.5</span> Pages</h2>
<p>As above, it is advisable to put all pages in a package as to separate them from models and custom widgets.</p>
<p>Pages contain the whole layout. To prevent duplication, custom widgets or partials should be created. This becomes necessary when depending on the user devices different widgets shall be rendered.</p>
<p>For example, Bootstrap splits a page into header, body and footer. You could create a trait <code>CustomPage</code> that contains all shared elements like header and footer and requires you only to define <code>body()</code> in the pages.</p>
<h1 id="build-process"><span class="header-section-number">4</span> Build process</h1>
<p>Widok uses sbt as its build system.</p>
<h2 id="development-releases"><span class="header-section-number">4.1</span> Development releases</h2>
<p>As with most programming languages, code optimisations are time-consuming and negligible during development. To compile the project without optimisations, run the following sbt command:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">sbt</span> fastOptJS</code></pre>
<p>Note that prefixing <code>~</code> makes sbt constantly check for changed source files and only recompiles when needed.</p>
<p>This generates two files in <code>target/scala-2.11/</code>:</p>
<ul>
<li><code>APPNAME-fastopt.js</code></li>
<li><code>APPNAME-launcher.js</code></li>
</ul>
<p>The former contains the whole project including its dependencies within a single JavaScript file, while the latter is a call to the entry point (see also chapter on <a href="Applications#Entry%20point">applications</a>).</p>
<p>It is safe to concatenate these two files and ship them to the client.</p>
<h2 id="production-releases"><span class="header-section-number">4.2</span> Production releases</h2>
<p>Scala.JS uses the Google Closure Compiler to apply code optimisations. To create an optimised build, run:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">sbt</span> fullOptJS</code></pre>
<p>Similarly as with <code>fastOptJS</code>, you can also prefix <code>~</code> here.</p>
<p>TBD Explain how to have maintain sbt setups for production and development releases. This is necessary in order to have use a different value for <code>-Xelidable-below</code>.</p>
<h2 id="links"><span class="header-section-number">4.3</span> Links</h2>
<p>For more information on the build process, please refer to the <a href="http://www.scala-js.org/doc/sbt/run.html">Scala.JS manual</a>.</p>
<h1 id="applications"><span class="header-section-number">5</span> Applications</h1>
<p>Although Widok provides certain abstractions for the DOM, it is not necessarily restricted to the browser or to displaying widgets. It was conceived with modularity in mind. Its libraries could also be beneficial in console applications or test cases.</p>
<h2 id="entry-point"><span class="header-section-number">5.1</span> Entry point</h2>
<p>Consider you have a one-file project consisting of:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">object</span> Main <span class="kw">extends</span> Application {
  <span class="kw">def</span> <span class="fu">main</span>() {
    <span class="fu">stub</span>()
  }
}</code></pre>
<p>An object of <code>Application</code> always defines the entry point of the application. There can only be one entry point.</p>
<p>Apparently, no browser-related functionality was used by the above code. Therefore, it also runs under node.js:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">sbt</span> fastOptJS
$ <span class="kw">cat</span> target/scala-2.11/*js <span class="kw">|</span> <span class="kw">node</span>
<span class="kw">stub</span></code></pre>
<p>You can also open it in the browser and as expected it will print <code>stub</code> in the browser console.</p>
<h2 id="application-providers"><span class="header-section-number">5.2</span> Application providers</h2>
<p>To reduce the amount of code needed to get started with Widok, it ships two application providers:</p>
<ul>
<li><code>PageApplication</code>: A single-page application</li>
<li><code>RoutingApplication</code>: A multi-page application with routing</li>
</ul>
<h3 id="single-page-applications-1"><span class="header-section-number">5.2.1</span> Single-page applications</h3>
<p>An example for <code>PageApplication</code> was already given in the chapter <a href="GettingStarted">Getting started</a>. The only difference over to a raw <code>Application</code> is that you need to implement the two methods <code>contents()</code> and <code>ready()</code>.</p>
<h3 id="multi-page-applications-1"><span class="header-section-number">5.2.2</span> Multi-page applications</h3>
<p>For multi-page applications you can use the default router as the application’s entry point. In order to do so, create an object of <code>RoutingApplication</code> with two arguments: the set of enabled routes and a fall-back route. See the chapter on <a href="routing">Router</a> for more information.</p>
<h1 id="router"><span class="header-section-number">6</span> Router</h1>
<p>When dealing with applications that consist of more than one page, a routing system becomes inevitable.</p>
<p>The router observes the URL’s fragment identifier. For example in <code>application.html#/page</code> the part after the hash symbol <code>/page</code> denotes the fragment identifier. A router is initialised with a set of routes which defines all addressable pages. A fallback route may also be specified.</p>
<h2 id="interface"><span class="header-section-number">6.1</span> Interface</h2>
<p>The router may be used as follows:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">object</span> Main <span class="kw">extends</span> Application {
    <span class="kw">val</span> main = <span class="fu">Route</span>(<span class="st">&quot;/&quot;</span>, pages.<span class="fu">Main</span>())
    <span class="kw">val</span> test = <span class="fu">Route</span>(<span class="st">&quot;/test/:param&quot;</span>, pages.<span class="fu">Test</span>())
    <span class="kw">val</span> test2 = <span class="fu">Route</span>(<span class="st">&quot;/test/:param/:param2&quot;</span>, pages.<span class="fu">Test</span>())
    <span class="kw">val</span> notFound = <span class="fu">Route</span>(<span class="st">&quot;/404&quot;</span>, pages.<span class="fu">NotFound</span>())

    <span class="kw">val</span> routes = Set(main, test, notFound)

    <span class="kw">def</span> <span class="fu">main</span>() {
        <span class="kw">val</span> router = <span class="fu">Router</span>(enabled, fallback = Some(notFound))
        router.<span class="fu">listen</span>()
    }
}</code></pre>
<p><code>routes</code> denotes the list of enabled routes. It should also contain the <code>notFound</code> route. Otherwise, this route could not be loaded using <code>#/404</code>.</p>
<h2 id="routes"><span class="header-section-number">6.2</span> Routes</h2>
<p>To construct a new route, pass the path and the page object to <code>Route()</code>. Page routes may be overloaded with different paths as above with <code>test</code> and <code>test2</code>.</p>
<p>A part of a path is the contents separated by a slash. For instance, the <code>test</code> route above has two parts: <code>test</code> and <code>:param</code>. A part beginning with a colon is a placeholder. It extracts the respective value from the URL’s fragment and binds it to the placeholder name. Note that a placeholder always refers to the whole part.</p>
<p>A route is said <em>instantiated</em> when it gets called:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="co">// Zero parameters</span>
<span class="kw">val</span> instMain: InstantiatedRoute = Main.<span class="fu">main</span>()

<span class="co">// One parameter</span>
<span class="kw">val</span> instTest: InstantiatedRoute = Main.<span class="fu">test</span>(<span class="st">&quot;param&quot;</span>, <span class="st">&quot;value&quot;</span>)

<span class="co">// Multiple parameters</span>
<span class="kw">val</span> instTest2: InstantiatedRoute = Main.<span class="fu">test2</span>(Map(
    <span class="st">&quot;param&quot;</span> -&gt; <span class="st">&quot;value&quot;</span>,
    <span class="st">&quot;param2&quot;</span> -&gt; <span class="st">&quot;value2&quot;</span>))

<span class="co">// Change the current page to /test/value</span>
instTest.<span class="fu">go</span>()</code></pre>
<p>To query the instantiated parameters, access the <code>args</code> field in the first parameter passed to <code>ready()</code>.</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">case</span> <span class="kw">class</span> <span class="fu">Test</span>() <span class="kw">extends</span> Page {
  ...
  <span class="kw">def</span> <span class="fu">ready</span>(route: InstantiatedRoute) {
    <span class="fu">log</span>(route.<span class="fu">args</span>(<span class="st">&quot;param&quot;</span>))

    <span class="co">// Accessing optional parameters with get()</span>
    <span class="co">// This returns an Option[String]</span>
    <span class="fu">log</span>(route.<span class="fu">args</span>.<span class="fu">get</span>(<span class="st">&quot;param2&quot;</span>))
  }
}</code></pre>
<h3 id="motivation"><span class="header-section-number">6.2.1</span> Motivation</h3>
<p>Due to the simple design the router could be efficiently implemented. The routes allow better reasoning than it would be possible if they supported regular expressions. When the router is constructed, it sorts all routes by their length and checks whether there are no conflicts. Also, the restriction that each parameter must be named makes code more readable when referring to parameters of an instantiated route. If validation of parameters is desired, this must be done in <code>ready()</code>. The advantages of the simple design outweigh its limitations.</p>
<h2 id="application-provider"><span class="header-section-number">6.3</span> Application provider</h2>
<p>As the router defines usually the entry point of an application, Widok provides an application provider that enforces better separation:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">object</span> Routes {
  <span class="kw">val</span> main = <span class="fu">Route</span>(<span class="st">&quot;/&quot;</span>, pages.<span class="fu">Main</span>())
  ...
  <span class="kw">val</span> notFound = <span class="fu">Route</span>(<span class="st">&quot;/404&quot;</span>, pages.<span class="fu">NotFound</span>())

  <span class="kw">val</span> routes = Set(main, ..., notFound)
}

<span class="kw">object</span> Main <span class="kw">extends</span> <span class="fu">RoutingApplication</span>(Routes.<span class="fu">routes</span>, Routes.<span class="fu">notFound</span>)</code></pre>
<p>This is to be preferred when no further logic should be executed in the entry point prior to setting up the router.</p>
<h1 id="widgets-1"><span class="header-section-number">7</span> Widgets</h1>
<p>A widget represents an element to be displayed by the browser. Instances of widgets can be nested while enforcing type-safety. Custom widgets can be defined. The idea here is to compose a widget of smaller, existing ones.</p>
<h2 id="html"><span class="header-section-number">7.1</span> HTML</h2>
<p>Widok provides widgets for many HTML elements. The bindings have a more intuitive naming than their HTML counterparts. The module they reside in is <code>org.widok.bindings.HTML</code>. Although it is possible to import the whole contents, it is advisable to address the widgets using a qualified access. Usually, a project needs to define its own widgets which most likely will shadow widgets from the HTML bindings. Instead, the custom widgets could be imported into the namespace. These custom widgets in turn will depend on the HTML widgets and only extend them with CSS tags for instance.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Tag</th>
<th style="text-align: left;">Widget</th>
<th style="text-align: left;">Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">h1</td>
<td style="text-align: left;">Heading.Level1</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">h2</td>
<td style="text-align: left;">Heading.Level2</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">h3</td>
<td style="text-align: left;">Heading.Level3</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">h4</td>
<td style="text-align: left;">Heading.Level4</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">h5</td>
<td style="text-align: left;">Heading.Level5</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">h6</td>
<td style="text-align: left;">Heading.Level6</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">p</td>
<td style="text-align: left;">Paragraph</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">b</td>
<td style="text-align: left;">Text.Bold</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">small</td>
<td style="text-align: left;">Text.Small</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">span</td>
<td style="text-align: left;">Raw</td>
<td style="text-align: left;">sets <code>innerHTML</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">img</td>
<td style="text-align: left;">Image</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">br</td>
<td style="text-align: left;">LineBreak</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">button</td>
<td style="text-align: left;">Button</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">section</td>
<td style="text-align: left;">Section</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">header</td>
<td style="text-align: left;">Header</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">footer</td>
<td style="text-align: left;">Footer</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">nav</td>
<td style="text-align: left;">Navigation</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">a</td>
<td style="text-align: left;">Anchor</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">form</td>
<td style="text-align: left;">Form</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">label</td>
<td style="text-align: left;">Label</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">input</td>
<td style="text-align: left;">Input.Text</td>
<td style="text-align: left;">sets <code>type=&quot;text&quot;</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">input</td>
<td style="text-align: left;">Input.Checkbox</td>
<td style="text-align: left;">sets <code>type=&quot;checkbox&quot;</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">select</td>
<td style="text-align: left;">Input.Select</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">ul</td>
<td style="text-align: left;">List.Unordered</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">ol</td>
<td style="text-align: left;">List.Ordered</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">li</td>
<td style="text-align: left;">List.Item</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">div</td>
<td style="text-align: left;">Container.Generic</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">span</td>
<td style="text-align: left;">Container.Inline</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<h3 id="usage"><span class="header-section-number">7.1.1</span> Usage</h3>
<p>A widget is always an instance of <code>Widget</code> and can be used like a function:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> widget = HTML.<span class="fu">Raw</span>(<span class="st">&quot;&lt;b&gt;&lt;i&gt;Text&lt;/i&gt;&lt;/b&gt;&quot;</span>)

<span class="co">// This is equivalent to:</span>
<span class="kw">val</span> widget2 = Text.<span class="fu">Bold</span>(
    Text.<span class="fu">Italic</span>(<span class="st">&quot;Text&quot;</span>))</code></pre>
<p>Most widgets either expect parameters or children. However, there are also widgets which expect both:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="fu">Anchor</span>(<span class="st">&quot;http://en.wikipedia.org/&quot;</span>)(
    Text.<span class="fu">Bold</span>(<span class="st">&quot;Wikipedia&quot;</span>))</code></pre>
<p><em>Hint:</em> Use the code completion of your IDE to figure out which widgets are available and which parameters to pass.</p>
<h2 id="bootstrap"><span class="header-section-number">7.2</span> Bootstrap</h2>
<p>Here is an example on how to use the Bootstrap bindings:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">package</span> org.<span class="fu">widok</span>.<span class="fu">example</span>.<span class="fu">pages</span>

<span class="kw">import</span> org.<span class="fu">widok</span>.<span class="fu">_</span>
<span class="kw">import</span> org.<span class="fu">widok</span>.<span class="fu">bindings</span>.<span class="fu">HTML</span>
<span class="kw">import</span> org.<span class="fu">widok</span>.<span class="fu">example</span>.<span class="fu">Routes</span>
<span class="kw">import</span> org.<span class="fu">widok</span>.<span class="fu">bindings</span>.<span class="fu">Bootstrap</span>.<span class="fu">_</span>

<span class="kw">case</span> <span class="kw">class</span> <span class="fu">Main</span>() <span class="kw">extends</span> Page {
  <span class="kw">def</span> <span class="fu">header</span>() =
    <span class="fu">NavigationBar</span>()(
      Container(
        NavigationBar.<span class="fu">Header</span>(
          NavigationBar.<span class="fu">Toggle</span>(),
          NavigationBar.<span class="fu">Brand</span>(<span class="st">&quot;Application name&quot;</span>)),
        NavigationBar.<span class="fu">Collapse</span>(
          NavigationBar.<span class="fu">Elements</span>(
            NavigationBar.<span class="fu">Leaf</span>(Routes.<span class="fu">notFound</span>())(
              <span class="fu">Glyphicon</span>(Glyphicon.<span class="fu">Search</span>), <span class="st">&quot;Page 1&quot;</span>),
            NavigationBar.<span class="fu">Leaf</span>(Routes.<span class="fu">notFound</span>())(
              <span class="fu">Glyphicon</span>(Glyphicon.<span class="fu">Bookmark</span>), <span class="st">&quot;Page 2&quot;</span>)),
          NavigationBar.<span class="fu">Right</span>(
            NavigationBar.<span class="fu">Navigation</span>(
              NavigationBar.<span class="fu">Form</span>(
                <span class="fu">FormGroup</span>(Role.<span class="fu">Search</span>)(
                  <span class="fu">InputGroup</span>(
                    Input.<span class="fu">Text</span>(placeholder = <span class="st">&quot;Search query…&quot;</span>)),
                  Button(Glyphicon.<span class="fu">Search</span>)())))))))

  <span class="kw">def</span> <span class="fu">contents</span>() = Seq(
    <span class="fu">header</span>(),
    Container(
      <span class="fu">PageHeader</span>(HTML.<span class="fu">Heading</span>.<span class="fu">Level1</span>(<span class="st">&quot;Page title &quot;</span>, HTML.<span class="fu">Text</span>.<span class="fu">Small</span>(<span class="st">&quot;Subtitle&quot;</span>))),
      <span class="fu">Lead</span>(<span class="st">&quot;Lead text&quot;</span>),
      <span class="st">&quot;Page body&quot;</span>),
    <span class="fu">Footer</span>(Container(<span class="fu">MutedText</span>(<span class="st">&quot;Example page - All rights reserved.&quot;</span>))))

  <span class="kw">def</span> <span class="fu">ready</span>(route: InstantiatedRoute) {}
}</code></pre>
<p>As probably more than one page is going to use the same header, you should create a trait for it. You may also want to write a trait <code>CustomPage</code> which only requires you to define the page title and body in every page.</p>
<p>For the bindings to work, add the latest Bootstrap stylesheet to the <code>head</code> tag of your <code>application.html</code> file. If you want to use a CDN, use:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href=</span><span class="st">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css&quot;</span><span class="kw">&gt;</span></code></pre>
<h2 id="creating-custom-widgets"><span class="header-section-number">7.3</span> Creating custom widgets</h2>
<p>Widgets should be designed to be restrictive. For example, the only children <code>List.Unordered()</code> accepts are instances of <code>List.Item</code>. For custom widgets, create a class hierarchy which closely resembles the intended nesting of the elements. This will turn out to be helpful because you implicitly establish type-safety for CSS components. When widgets are changed, this will catch usage errors during compile-time.</p>
<p>A custom widget may be defined as follows:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">def</span> Panel(contents: Widget*) =
    HTML.<span class="fu">Container</span>.<span class="fu">Generic</span>(
      HTML.<span class="fu">Container</span>.<span class="fu">Generic</span>(
        contents: _*
      ).<span class="fu">css</span>(<span class="st">&quot;panel-body&quot;</span>)
    ).<span class="fu">css</span>(<span class="st">&quot;panel&quot;</span>, <span class="st">&quot;panel-default&quot;</span>)</code></pre>
<p>This corresponds to:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;panel panel-default&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;panel-body&quot;</span><span class="kw">&gt;</span>
        ... contents of the widget's children ...
    <span class="kw">&lt;/div&gt;</span>
<span class="kw">&lt;/div&gt;</span></code></pre>
<h2 id="binding-to-events"><span class="header-section-number">7.4</span> Binding to events</h2>
<p>Each widget provides useful functions to better interact with the DOM. Instead of setting IDs on elements and requesting elements using <code>getElementById()</code>, we are constantly working with objects which is less error-prone.</p>
<p>To bind to the click event to a button, write:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">import</span> org.<span class="fu">scalajs</span>.<span class="fu">dom</span>.<span class="fu">MouseEvent</span>

...

Button(Glyphicon.<span class="fu">Book</span>)(<span class="st">&quot;Show timestamp&quot;</span>)
    .<span class="fu">bindMouse</span>(Event.<span class="fu">Mouse</span>.<span class="fu">Click</span>, (e: MouseEvent) =&gt; <span class="fu">println</span>(e.<span class="fu">timeStamp</span>))</code></pre>
<p>Note that methods on a widget return the instance of the widget. This allows to arbitrarily nest widgets and change their attributes, without storing a reference to the widget in a local variable.</p>
<p>The above example does not seem all too different from attaching a callback like in JavaScript. This is also what happens implicitly. In fact, the second argument of <code>bindMouse()</code> expects a <em>Channel</em>, a concept we will introduce in the next chapter. A channel produces data which is passed on to its subscribers. In the above example, a Scala implicit turns the lambda function into a channel. But similarly, we could have written:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> click = Channel[MouseEvent]()
click.<span class="fu">attach</span>(e =&gt; <span class="fu">println</span>(e.<span class="fu">timeStamp</span>))
...

Button(Glyphicon.<span class="fu">Book</span>)(<span class="st">&quot;Show timestamp&quot;</span>)
    .<span class="fu">bindMouse</span>(Event.<span class="fu">Mouse</span>.<span class="fu">Click</span>, click)</code></pre>
<p>The advantage may not be obvious on first sight, but a channel can have multiple subscribers. This is important in web applications where data gets propagated to various layers of the application. For example, consider a shopping cart. Items get modified in the product listing. At the same time the header needs to get updated with the newly calculated price.</p>
<p>Now that <code>click</code> is a stream of events, we could decide to take into account only the first event:</p>
<pre class="sourceCode scala"><code class="sourceCode scala">click.<span class="fu">head</span>.<span class="fu">attach</span>(e =&gt; <span class="fu">println</span>(e.<span class="fu">timeStamp</span>))</code></pre>
<p>Another prominent use case of channels are dynamic changes of widgets, such as the visibility:</p>
<pre class="sourceCode scala"><code class="sourceCode scala">HTML.<span class="fu">Container</span>.<span class="fu">Generic</span>(<span class="st">&quot;Button clicked&quot;</span>)
    .<span class="fu">show</span>(click.<span class="fu">head</span>.<span class="fu">map</span>(_ =&gt; <span class="kw">false</span>))</code></pre>
<p><code>show()</code> expects a boolean channel. Depending on the values that are sent to the channel a widget is shown or not. Here, we hide the widget as soon as we click the button.</p>
<p>The chapter <a href="#data-propagation">Data propagation</a> deals with channels in detail.</p>
<h2 id="links-1"><span class="header-section-number">7.5</span> Links</h2>
<ul>
<li><a href="http://widok.github.io/api/v0.1.1/index.html">API documentation</a></li>
</ul>
<h1 id="data-propagation-1"><span class="header-section-number">8</span> Data Propagation</h1>
<p>Due to its nature, user interfaces (UIs) are notoriously heavily data-driven. Values do not only need to be displayed once, but continuously modified as the user interacts with the interface.</p>
<p>A higher interactivity results in more data dependencies and ultimately in more complex code. Imperative code in particular is prone to this shortcoming as dependencies must be modelled manually. With web application getting increasingly more interactive, solutions with clean and concise code are needed.</p>
<p>Widok advocates a flow-driven approach: Values are expressed in a stream-like data structure which we call <em>channel</em>. A channel is equipped with operations that allow to easily express data dependencies. Channels can have children to which the incoming values are propagated.</p>
<p>Built on top of channels, there is another data structure called <em>aggregates</em>. Channels model single values while aggregates represent a collection of values.</p>
<p>A key concept of channels and aggregates is that data may be rendered directly to the DOM without any intermediate caching. Whenever a new value is pushed to a channel, an atomic update takes place, only changing the associated DOM node. Similarly, this is respected when inserting, updating or removing items in an aggregate.</p>
<p>For an application that makes heavy use of data propagation, see our <a href="https://github.com/widok/todomvc">TodoMVC implementation</a>.</p>
<p>The proper functioning of each operation is backed by <a href="https://github.com/widok/widok/tree/master/src/test/scala/org/widok">test cases</a>. These serve as a complementary documentation as only a handful of operations are explained in full detail here.</p>
<h2 id="channels"><span class="header-section-number">8.1</span> Channels</h2>
<p>A channel is a multiplexer for typed messages (immutable values) that it receives. Values sent to the channel get propagated to the observers that have been attached to the channel, in the same order as they were added.</p>
<p>As outlined above, channels are a memory-efficient model and may be bound to widgets. The widget renders the received values on-the-fly. However, the lack of state restricts the possibilities. It may be desired to obtain the current value of a channel, change it or perform more elaborate operations that inherently require caching. This was taken into consideration and explicit caching can be performed.</p>
<p>Here is a simple example for a channel that receives integers and prints these on the console:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> ch = Channel[Int]()  <span class="co">// initialise</span>
ch.<span class="fu">attach</span>(println)       <span class="co">// attach observer</span>
ch := <span class="dv">42</span>                 <span class="co">// produce value</span></code></pre>
<blockquote>
<p><strong>Note:</strong> The <code>:=</code> operator is a shortcut for the method <code>produce</code>.</p>
</blockquote>
<p>Channels define useful operations to express data dependencies:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> ch = Channel[Int]()
ch.<span class="fu">filter</span>(_ &gt; <span class="dv">3</span>)
  .<span class="fu">map</span>(_ + <span class="dv">1</span>)
  .<span class="fu">attach</span>(println)
ch := <span class="dv">42</span> <span class="co">// 43 printed</span>
ch := <span class="dv">1</span>  <span class="co">// nothing printed</span></code></pre>
<p>These operations are well-known methods such as <code>map()</code>, <code>filter()</code>, <code>take()</code> etc. As they return instances of <code>Channel</code>, they can be chained as in the example.</p>
<p>A particular operator defined on channels is the addition. By adding up channels a new container channel is constructed. All values produced by the operands are propagated to this resulting channel and vice-versa (two-way propagation), but not amongst the operands:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> cont = ch + ch2  <span class="co">// more operands are possible, too</span>
ch  := <span class="dv">42</span>            <span class="co">// propagated to cont</span>
ch2 := <span class="dv">23</span>            <span class="co">// propagated to cont</span>
cont := <span class="dv">65</span>           <span class="co">// propagated to ch and ch2</span></code></pre>
<h3 id="state-channels"><span class="header-section-number">8.1.1</span> State channels</h3>
<p>State channels are channels that have an initial value. In reactive programming, these are known as <em>cold observers</em>.</p>
<p>The value that the state channel was instantiated with gets propagated upon attaching to the channel. A common use case are user interfaces. Usually, channels are set up before the widgets. The channels are then bound to the widgets. This renders the initial value directly in the DOM. Otherwise, it would be necessary to send the initial value to the channel manually as soon as the widget was rendered.</p>
<p>The following example visualises the difference in behaviour:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> ch = Channel.<span class="fu">unit</span>(<span class="dv">42</span>)
ch.<span class="fu">attach</span>(println) <span class="co">// prints 42</span>

<span class="kw">val</span> ch2 = Channel[Int]()
ch2 := <span class="dv">42</span> <span class="co">// lost as ch2 does not have any observers</span>
ch2.<span class="fu">attach</span>(println)</code></pre>
<blockquote>
<p><strong>Note:</strong> <code>Channel.unit(value)</code> is equal to <code>StateChannel(value)</code>.</p>
</blockquote>
<p>The argument is evaluated lazily and can also point to a mutable variable:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">var</span> counter = <span class="dv">0</span>
<span class="kw">val</span> ch = Channel.<span class="fu">unit</span>(counter)
ch.<span class="fu">attach</span>(value =&gt; {counter += <span class="dv">1</span>; <span class="fu">println</span>(value)}) <span class="co">// prints 0</span>
ch.<span class="fu">attach</span>(value =&gt; {counter += <span class="dv">1</span>; <span class="fu">println</span>(value)}) <span class="co">// prints 1</span></code></pre>
<p>The following example illustrates a conceptual issue that arises with the use of chaining:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> ch = Channel.<span class="fu">unit</span>(<span class="dv">42</span>)
<span class="kw">val</span> ch2 = ch.<span class="fu">map</span>(_ + <span class="dv">1</span>)
ch2.<span class="fu">attach</span>(...) <span class="co">// produces 43?</span>
ch2.<span class="fu">attach</span>(...) <span class="co">// produces 43?</span></code></pre>
<p>The question is whether initially produced values get propagated along the chain of operations.</p>
<h3 id="child-channels"><span class="header-section-number">8.1.2</span> Child channels</h3>
<p>In order to make all operations work properly on state channels, the notion of <em>child channels</em> was introduced. The previously given example is therefore well-defined. A child channel delays the propagation of the initial value until an observer is attached.</p>
<p>In order to figure out whether an operation supports this behaviour, it is sufficient to investigate its return type. The child channel behaviour only makes sense on operations that do not need more than one produced value to propagate it. A counterexample is <code>skip()</code> which conceptually must skip at least one element; the initial value will therefore never be propagated:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> ch = Channel.<span class="fu">unit</span>(<span class="dv">42</span>)
ch.<span class="fu">skip</span>(<span class="dv">1</span>) <span class="co">// returns Channel</span>
  .<span class="fu">attach</span>(...)</code></pre>
<blockquote>
<p><strong>Note:</strong> Higher-order functions must not have any side-effects when used in operations on state channels.</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> ch = Channel.<span class="fu">unit</span>(<span class="dv">42</span>)
ch.<span class="fu">map</span>(println).<span class="fu">attach</span>(_ =&gt; ())</code></pre>
<p>The example does not behave as expected and prints 42 two times instead of only once. This design decision was made consciously as to keep the implementation of operations more simple.</p>
</blockquote>
<h3 id="cached-channels"><span class="header-section-number">8.1.3</span> Cached channels</h3>
<p>For better performance, channels do not cache the produced values. Some operations cannot be implemented without access to the current value, though. Therefore, <em>cached channels</em> were introduced.</p>
<p>For example, <code>update()</code> is an operation that would not work without caching. It takes a function which modifies the current value:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> ch = CachedChannel[Test]()
ch.<span class="fu">attach</span>(println)
ch := <span class="dv">2</span>
ch.<span class="fu">update</span>(_ + <span class="dv">1</span>) <span class="co">// produces 3</span></code></pre>
<p><code>value()</code> is another helpful operation. It creates a channel lens. If a channel is made up of a <code>case class</code>, you could obviously use <code>.map(_.field)</code> to obtain a channel for a field. However, as with lenses in functional programming, a back channel is desired which composes a new value with this field changed. This also works with nested values as in the following example:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">case</span> <span class="kw">class</span> <span class="fu">Base</span>(a: Int)
<span class="kw">case</span> <span class="kw">class</span> <span class="fu">Test</span>(a: String, b: Base)

<span class="kw">val</span> ch = CachedChannel[Test]()
<span class="kw">val</span> lens = ch.<span class="fu">value</span>[Int](_ &gt;&gt; 'b &gt;&gt; 'a)

ch.<span class="fu">attach</span>(println)

ch := <span class="fu">Test</span>(<span class="st">&quot;hello world&quot;</span>, <span class="fu">Base</span>(<span class="dv">1</span>))
lens := <span class="dv">2</span> <span class="co">// produces Test(&quot;hello world&quot;, Base(2)) on ch</span></code></pre>
<p>In order to get a cached version of an existing channel, use the method <code>cache</code>:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> cache = ch.<span class="fu">cache</span>
ch := <span class="dv">1</span>
cache.<span class="fu">update</span>(_ + <span class="dv">1</span>) <span class="co">// produces 2 on ``ch``</span></code></pre>
<p>Use the method <code>unique</code> to produce a value if it is the first or different from the previous one. A use case is sending HTTP requests upon user input:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> ch = cache.<span class="fu">unique</span>
ch.<span class="fu">attach</span> { query =&gt;
    <span class="co">// perform HTTP request</span>
}</code></pre>
<blockquote>
<p><strong>Note:</strong> As a <code>CachedChannel</code> inherits from <code>Channel</code>, all channel operations are available as well.</p>
</blockquote>
<h3 id="widgets-2"><span class="header-section-number">8.1.4</span> Widgets</h3>
<p>A channel can be connected with one or more widgets. Most widgets provide two-way binding. To bind a channel to a widget, use the method <code>bind()</code> or its specialisations <code>bindRaw()</code>, <code>bindWidget()</code> etc.</p>
<p>When associating a channel to multiple widgets, the contents amongst them is synchronised automatically:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> ch = Channel.<span class="fu">unit</span>(<span class="st">&quot;Hello world&quot;</span>)
<span class="kw">def</span> <span class="fu">contents</span>() = Seq(
  Input.<span class="fu">Text</span>().<span class="fu">bind</span>(ch, live = <span class="kw">true</span>),
  Input.<span class="fu">Text</span>().<span class="fu">bind</span>(ch)
)</code></pre>
<p>This creates two text fields. When the page is loaded, both have the same content: <q>Hello world</q>. If the user changes the text of the first field, the second text field is updated on-the-fly. The second field has the live mode disabled and an enter press is required before the change gets propagated to the first text box.</p>
<blockquote>
<p><strong>Note:</strong> <code>bind()</code> may only be used once. If you want to have multiple event handlers, you can chain these using the <code>+</code> operator that was mentioned above.</p>
</blockquote>
<p>Channels are consistently used for all kind of DOM events. This allows to connect even two unrelated widgets. The following example connects a text field with a button:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> query = Channel[String]()
<span class="kw">val</span> click = Channel[Unit]()

query.<span class="fu">attach</span>(println)

<span class="kw">def</span> <span class="fu">contents</span>() = Seq(
  Input.<span class="fu">Text</span>().<span class="fu">bind</span>(query, click),
  Button().<span class="fu">bind</span>(click)
)</code></pre>
<p>The second parameter of <code>bind()</code> on the text field is a channel that <q>flushes</q> its contents. Sending a message to it is equivalent to pressing enter in the field. The button is bound to the same channel. Pressing the button results in the text field to produce its contents to <code>query</code>. If widgets were using callbacks instead, the above would be a lot harder to implement.</p>
<p>The method <code>cssCh()</code> on widgets sets a CSS flag only if the expected boolean channel produces <code>true</code> values, otherwise it is unset:</p>
<pre class="sourceCode scala"><code class="sourceCode scala">widget
 .<span class="fu">cssCh</span>(editing, <span class="st">&quot;editing&quot;</span>)</code></pre>
<p>An implicit is defined so that string channels can be used easily:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> name = Channel[String]()
<span class="kw">def</span> <span class="fu">contents</span>() = Heading.<span class="fu">Level1</span>(<span class="st">&quot;Hello &quot;</span>, name)</code></pre>
<p><code>name</code> is converted into a widget and updates the DOM when new values are produced.</p>
<p>Another implicit is provided for <code>Channel[Widget]</code>. You can use <code>map()</code> on a channel to create a widget stream. These are rendered automatically. If the widget type is always the same and it provides a <code>bind()</code> method, this is to be preferred instead. <code>bind()</code> does not recreate the widget itself and is therefore more efficient.</p>
<h2 id="aggregates"><span class="header-section-number">8.2</span> Aggregates</h2>
<p>Aggregates allow to efficiently deal with lists of changing values. An aggregate is implemented as a list of channels.</p>
<p>You may be wondering what is the purpose of having <code>Aggregate[T]</code> while <code>Channel[Seq[T]]</code> could be used. If you need to operate on a subsets, it is hard to do so with the latter approach. What’s more, it is also a costly operation. If, however, the elements of your list are constant, you should use the channel approach. Widgets provide <code>bind()</code> for both variants.</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> agg = Aggregate[Int]()
<span class="kw">val</span> ch = agg.<span class="fu">append</span>() <span class="co">// adds a new row; returns Channel</span>
ch := <span class="dv">42</span>              <span class="co">// sets row value to 42</span></code></pre>
<p>As with channels, an added row is lost if no observer was added beforehand. In practice, attaching a self-written observers is not as common as for channels. Widok already provides important operations and aggregates are most useful in connection with widgets. The general recommendation is to never use <code>attach()</code> to keep the code clean. Observers can get messy, especially if back-propagation is involved. If an observer becomes necessary, in almost every case this indicates that an operation should be implemented instead. Refer to the test cases for more information on writing observers for aggregates.</p>
<p>To observe the size of an aggregate, use <code>size</code> which returns a <code>Channel[Int]</code>:</p>
<pre class="sourceCode scala"><code class="sourceCode scala">agg.<span class="fu">size</span>.<span class="fu">attach</span>(println)</code></pre>
<p>As aggregates are just containers for channels, it is possible to obtain sub-lists and propagate changes back:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> agg = Aggregate[Int]()
<span class="kw">val</span> filter = agg.<span class="fu">filter</span>(_ % <span class="dv">2</span> == <span class="dv">0</span>)

agg.<span class="fu">append</span>(<span class="dv">3</span>)  <span class="co">// not propagated</span>
agg.<span class="fu">append</span>(<span class="dv">4</span>)  <span class="co">// propagated</span>
agg.<span class="fu">append</span>(<span class="dv">5</span>)  <span class="co">// not propagated</span>

filter.<span class="fu">clear</span>() <span class="co">// back-propagates the deletion to agg</span>
               <span class="co">// agg will only contain 3 and 5.</span></code></pre>
<blockquote>
<p><strong>Note:</strong> Not every operation implements back-propagation.</p>
</blockquote>
<h3 id="cached-aggregates"><span class="header-section-number">8.2.1</span> Cached aggregates</h3>
<p>Similarly to channels, there is a cached counterpart which stores the most recent value for each row.</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> agg = Aggregate[Int]()
<span class="kw">val</span> cached = agg.<span class="fu">cache</span></code></pre>
<p>The method <code>filterCh()</code> expects a channel that is producing filter functions:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> f = Channel[Int =&gt; Boolean]()
<span class="kw">val</span> filtered = cached.<span class="fu">filterCh</span>(f)

f := _ &gt; <span class="dv">1</span>
f := _ &gt; <span class="dv">2</span></code></pre>
<p>Every time a new filter function is produced to <code>f</code>, the filter is applied on all elements from <code>agg</code> and <code>filtered</code> subsequently only contains those matching ones.</p>
<h3 id="widgets-3"><span class="header-section-number">8.2.2</span> Widgets</h3>
<p>All list-like widgets (such as tables) provide the method <code>bind()</code>:</p>
<pre class="sourceCode scala"><code class="sourceCode scala">List.<span class="fu">Unordered</span>().<span class="fu">bind</span>(agg) { ch =&gt;
  List.<span class="fu">Item</span>(ch)
}</code></pre>
<p>Aggregates implement many operations which interact nicely with widgets: <code>isEmpty</code> could be used to hide widgets if an aggregate is empty:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> agg = Aggregate[Int]()

<span class="kw">val</span> widget = HTML.<span class="fu">Container</span>.<span class="fu">Inline</span>(<span class="st">&quot;The list is empty.&quot;</span>)
  .<span class="fu">show</span>(agg.<span class="fu">isEmpty</span>)

<span class="kw">val</span> widget2 = HTML.<span class="fu">Container</span>.<span class="fu">Inline</span>(<span class="st">&quot;The list is not empty.&quot;</span>)
  .<span class="fu">show</span>(agg.<span class="fu">nonEmpty</span>)</code></pre>
<h2 id="debugging"><span class="header-section-number">8.3</span> Debugging</h2>
<p>Although, channels and aggregates are used by widgets, they do not depend on JavaScript features. You can therefore debug their use directly on the console:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">sbt</span> console
<span class="kw">import</span> org.widok._
<span class="kw">val</span> ch = Channel[Int]()
<span class="kw">ch.attach</span>(println)
<span class="kw">ch</span> := 42</code></pre>
<h2 id="api-documentation"><span class="header-section-number">8.4</span> API documentation</h2>
<ul>
<li><a href="http://widok.github.io/api/v0.1.1/index.html#org.widok.Channel">Channel</a></li>
<li><a href="http://widok.github.io/api/v0.1.1/index.html#org.widok.Aggregate">Aggregate</a></li>
</ul>
<h1 id="developing"><span class="header-section-number">9</span> Developing</h1>
<h2 id="api"><span class="header-section-number">9.1</span> API</h2>
<p>Widok is still in its early stages and the API may be subject to changes. Any recommendations for improvements are welcome.</p>
<h2 id="compilation-1"><span class="header-section-number">9.2</span> Compilation</h2>
<p>To work on the development version of Widok, run the following commands:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">git</span> clone git@github.com:widok/widok.git
$ <span class="kw">cd</span> widok
$ <span class="kw">sbt</span> publish-local</code></pre>
<p>This compiles the latest version of Widok and installs it locally. To use it, make sure to also update the version in your project accordingly.</p>
<h2 id="releases"><span class="header-section-number">9.3</span> Releases</h2>
<p>The manual must always reflect the latest version.</p>
<div class="references">

</div>

</body>
</html>
